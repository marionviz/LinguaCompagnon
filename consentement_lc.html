<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consentement de participation - LinguaCompagnon</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Signature Pad Library -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }
        
        .consent-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header-section {
            background: linear-gradient(135deg, #90c695 0%, #5a9c61 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px 15px 0 0;
        }
        
        .signature-canvas {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: crosshair;
            background: #f8f9fa;
        }
        
        .section-title {
            color: #90c695;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #90c695;
            padding-bottom: 0.5rem;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #90c695;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 5px;
        }
        
        .btn-primary {
            background: #90c695;
            border-color: #90c695;
        }
        
        .btn-primary:hover {
            background: #7ab67f;
            border-color: #7ab67f;
        }
        
        .signature-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 2rem;
        }
        
        .required {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="consent-card">
            <!-- En-t√™te -->
            <div class="header-section text-center">
                <h1 class="mb-2">üìù Consentement de participation</h1>
                <h4>Phase pilote LinguaCompagnon</h4>
                <p class="mb-0">P√©riode : 12 janvier - 27 mars 2026</p>
            </div>
            
            <!-- Corps du document -->
            <div class="p-4">
                <!-- Contexte -->
                <div class="info-box">
                    <p class="mb-0"><strong>Contexte :</strong> Cet artefact est con√ßu dans une d√©marche de recherche pour le m√©moire de master 2 d'Ing√©nierie p√©dagogique multimodale √† l'Universit√© de Lille en collaboration avec l'ONUG.</p>
                    <p class="mb-0 mt-2"><strong>Acc√®s :</strong> <a href="https://linguacompagnon.vercel.app" target="_blank">LinguaCompagnon: votre assistant personnel IA</a></p>
                </div>
                
                <!-- Objectif -->
                <h3 class="section-title">üéØ Objectif du projet</h3>
                <p>LinguaCompagnon est un assistant conversationnel IA con√ßu pour accompagner l'apprenance du fran√ßais langue √©trang√®re. Cette phase pilote vise √† tester l'outil en situation r√©elle et √† recueillir vos retours pour l'am√©liorer.</p>
                
                <!-- Engagement mutuel -->
                <h3 class="section-title">ü§ù Engagement mutuel</h3>
                
                <h5 class="mt-3">L'apprenant¬∑e s'engage √† :</h5>
                <ul>
                    <li>Utiliser LinguaCompagnon de mani√®re r√©guli√®re sur la p√©riode d√©finie</li>
                    <li>Participer √† 2 entretiens individuels de 15 minutes (retour d'exp√©rience)</li>
                    <li>Partager ses observations sur l'utilit√© et les limites de l'outil</li>
                </ul>
                
                <h5 class="mt-3">Marion Vizier-Marzais (responsable du projet) s'engage √† :</h5>
                <ul>
                    <li>Assurer un accompagnement personnalis√© tout au long de la phase pilote</li>
                    <li>Garantir la confidentialit√© des √©changes et donn√©es personnelles</li>
                    <li>R√©pondre aux questions techniques et p√©dagogiques dans un d√©lai de 48h</li>
                </ul>
                
                <!-- Utilisation et limites -->
                <h3 class="section-title">‚ö†Ô∏è Utilisation et limites</h3>
                <p>LinguaCompagnon est un <strong>outil d'entra√Ænement</strong>, pas un substitut √† l'enseignement humain. L'IA peut faire des erreurs ou des impr√©cisions : validez toujours les informations importantes avec votre formatrice.</p>
                
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Ne partagez aucune information sensible</strong><br>
                    Les conversations servent uniquement √† d√©velopper vos comp√©tences linguistiques. N'y partagez aucune information sensible (donn√©es professionnelles confidentielles, informations personnelles sensibles).
                </div>
                
                <!-- Protection des donn√©es -->
                <h3 class="section-title">üîí Protection des donn√©es et confidentialit√©</h3>
                
                <h5 class="mt-3">Donn√©es collect√©es</h5>
                <p>LinguaCompagnon traite deux types de donn√©es :</p>
                <ol>
                    <li><strong>Vos corrections et notes personnelles :</strong> stock√©es uniquement sur votre ordinateur (localStorage de votre navigateur). Vous en √™tes l'unique propri√©taire.</li>
                    <li><strong>Vos conversations avec les avatars :</strong> trait√©es par Google Cloud AI (Gemini & Text-to-Speech) pour g√©n√©rer les r√©ponses et synth√©tiser la voix.</li>
                </ol>
                
                <h5 class="mt-3">Traitement par Google Cloud AI</h5>
                <p>Google s'engage contractuellement √† <strong>ne pas utiliser vos donn√©es</strong> pour entra√Æner ses mod√®les d'intelligence artificielle. Les donn√©es de conversations sont trait√©es en temps r√©el puis supprim√©es apr√®s traitement.</p>
                
                <p><strong>Conservation temporaire :</strong></p>
                <ul>
                    <li>Logs de s√©curit√© (d√©tection d'abus/spam) : 30 jours maximum</li>
                    <li>Apr√®s 30 jours : suppression automatique et d√©finitive</li>
                </ul>
                
                <p><strong>Acc√®s aux donn√©es :</strong></p>
                <ul>
                    <li>Marion Vizier-Marzais (responsable du projet) n'a <strong>aucun acc√®s</strong> √† vos conversations</li>
                    <li>Google traite les donn√©es uniquement pour faire fonctionner l'outil</li>
                    <li>Aucune donn√©e nominative ne sera diffus√©e sans votre accord explicite</li>
                </ul>
                
                <h5 class="mt-3">Vos droits (RGPD)</h5>
                <p>Vous disposez d'un droit d'acc√®s, de modification et de suppression de vos donn√©es √† tout moment :</p>
                <ul>
                    <li>Pour acc√©der √† l'outil, vous ne vous identifiez pas, vous ne cr√©ez pas de compte</li>
                    <li>Supprimer vos corrections : vider le cache de votre navigateur (delete browsing data)</li>
                    <li>Demander des informations sur vos donn√©es : contacter <a href="/cdn-cgi/l/email-protection#96fbf7e4fff9f8e0ffecd6fef9e2fbf7fffab8f5f9fb"><span class="__cf_email__" data-cfemail="1875796a7177766e71625870776c75797174367b7775">[email&#160;protected]</span></a></li>
                    <li>Les r√©sultats de la phase pilote seront anonymis√©s dans le m√©moire de recherche</li>
                </ul>
                
                <div class="info-box">
                    <strong>üìã Sources officielles</strong><br>
                    ‚Ä¢ Conditions d'utilisation Google : <a href="https://ai.google.dev/gemini-api/terms" target="_blank">ai.google.dev/gemini-api/terms</a><br>
                    ‚Ä¢ Politique Google Cloud TTS : <a href="https://cloud.google.com/text-to-speech/docs/data-logging" target="_blank">cloud.google.com/text-to-speech/docs/data-logging</a>
                </div>
                
                <!-- Participation volontaire -->
                <h3 class="section-title">‚úã Participation volontaire</h3>
                <p>Votre participation est enti√®rement <strong>volontaire</strong>. Vous pouvez vous retirer du projet √† tout moment, sans justification et sans cons√©quence.</p>
                
                <!-- Formulaire de signature -->
                <div class="signature-section">
                    <h3 class="section-title">‚úçÔ∏è Signatures</h3>
                    
                    <form id="consentForm">
                        <!-- Informations participant -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5>Participant¬∑e</h5>
                                <div class="mb-3">
                                    <label class="form-label">Pr√©nom <span class="required">*</span></label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nom <span class="required">*</span></label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email <span class="required">*</span></label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5>Responsable du projet</h5>
                                <div class="mb-3">
                                    <label class="form-label">Nom</label>
                                    <input type="text" class="form-control" value="Marion Vizier-Marzais" disabled>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Date</label>
                                    <input type="text" class="form-control" value="Le 5 janvier 2026" disabled>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Consentement explicite -->
                        <div class="mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="consentCheck" required>
                                <label class="form-check-label" for="consentCheck">
                                    <strong>J'ai lu et compris l'accord de consentement ci-dessus. Je consens librement √† participer √† la phase pilote de LinguaCompagnon.</strong> <span class="required">*</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Zone de signature -->
                        <div class="mb-4">
                            <label class="form-label">Signature √©lectronique <span class="required">*</span></label>
                            <p class="text-muted small">Dessinez votre signature dans le cadre ci-dessous</p>
                            <canvas id="signaturePad" class="signature-canvas" width="600" height="200"></canvas>
                            <div class="mt-2">
                                <button type="button" class="btn btn-secondary btn-sm" id="clearSignature">
                                    üóëÔ∏è Effacer
                                </button>
                            </div>
                        </div>
                        
                        <!-- Date automatique -->
                        <div class="mb-4">
                            <label class="form-label">Date de signature</label>
                            <input type="text" class="form-control" id="signatureDate" readonly>
                        </div>
                        
                        <!-- Bouton de soumission -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                ‚úÖ Valider mon consentement
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Script de gestion -->
    <script>
        // ‚ö° CONFIGURATION EMAILJS - REMPLACEZ CES 3 VALEURS
        const EMAILJS_PUBLIC_KEY = 'wuwE6ibesX6H3lq-L';  // Ex: user_ABCD1234
        const EMAILJS_SERVICE_ID = 'service_8fqgy4l';  // Ex: service_abc123
        const EMAILJS_TEMPLATE_ID = 'template_1pw4e1j'; // Ex: template_xyz789
        
        // Initialiser EmailJS
        emailjs.init(EMAILJS_PUBLIC_KEY);
        
        // Initialisation de la date
        document.getElementById('signatureDate').value = new Date().toLocaleDateString('fr-FR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // Initialisation du pad de signature
        const canvas = document.getElementById('signaturePad');
        const signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgb(248, 249, 250)',
            penColor: 'rgb(0, 0, 0)'
        });
        
        // Adapter le canvas √† la taille responsive
        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            signaturePad.clear();
        }
        
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();
        
        // Bouton effacer
        document.getElementById('clearSignature').addEventListener('click', () => {
            signaturePad.clear();
        });
        
        // Soumission du formulaire
        document.getElementById('consentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // V√©rifier que la signature n'est pas vide
            if (signaturePad.isEmpty()) {
                alert('‚ö†Ô∏è Veuillez signer dans le cadre pr√©vu √† cet effet.');
                return;
            }
            
            // D√©sactiver le bouton pendant l'envoi
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚è≥ Envoi en cours...';
            
            // R√©cup√©rer les donn√©es
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                signatureDate: document.getElementById('signatureDate').value,
                signature: signaturePad.toDataURL(),
                timestamp: new Date().toISOString(),
                consent: true
            };
            
            try {
                // Envoyer par EmailJS
                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                    participant_name: formData.firstName + ' ' + formData.lastName,
                    participant_email: formData.email,
                    signature_date: formData.signatureDate,
                    timestamp: new Date().toLocaleString('fr-FR'),
                    to_email: 'marionviz@hotmail.com', // Votre email
                    reply_to: formData.email
                });
                
                // Enregistrer localement aussi (backup)
                localStorage.setItem('linguacompagnon_consent', JSON.stringify(formData));
                
                // Succ√®s !
                alert('‚úÖ Votre consentement a √©t√© enregistr√© avec succ√®s !\n\nVous et Marion avez re√ßu une copie par email.');
                
                // T√©l√©charger aussi une copie locale
                downloadConsent(formData);
                
                // Optionnel : Rediriger vers LinguaCompagnon
                // setTimeout(() => {
                //     window.location.href = 'https://linguacompagnon.vercel.app';
                // }, 2000);
                
            } catch (error) {
                console.error('Erreur EmailJS:', error);
                alert('‚ùå Erreur lors de l\'envoi. Veuillez r√©essayer ou contacter Marion directement.\n\nVotre signature sera quand m√™me t√©l√©charg√©e localement.');
                downloadConsent(formData);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '‚úÖ Valider mon consentement';
            }
        });
        
        // Fonction pour t√©l√©charger le consentement
        function downloadConsent(data) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.crea}